server {
{% if item.server_name is defined %}
    server_name {{ item.server_name }};
{% endif %}
{% if item.commands is defined %}
{% for command in item.commands %}
    {{ command }};
{% endfor %}
{% endif %}
{% if item.ssl is defined %}
    listen {{ item.ssl.port|default(443) }} ssl;

    ssl_protocols       {{ item.ssl.protocols|default(nginx_ssl_protocols) }};
    ssl_certificate     {{ item.ssl.certificate }};
    ssl_certificate_key {{ item.ssl.certificate_key }};
    ssl_prefer_server_ciphers {{ ssl_prefer_server_ciphers }};
    ssl_dhparam {{ dh_group_key_file }};
    ssl_ciphers '{{ ssl_ciphers }}';
    ssl_stapling {{ ssl_stapling }};
    ssl_stapling_verify {{ item.ssl.stapling_verify|default(ssl_stapling_verify) }};
{% endif %}

{% if item.locations is defined %}
{% for location in item.locations %}
    location {% if location.path is defined %}{{ location.path }}{% else %}/{% endif %} {
{% if location.commands is defined %}
{% for command in location.commands %}
        {{ command }};
{% endfor %}
{% endif %}
{% if location.proxy is defined %}
        proxy_pass {{ location.proxy }};
        include    /etc/nginx/proxy_params;
{% endif %}
{% if location.alias is defined %}
        alias {{ location.alias }};
{% endif %}
    }
{% endfor %}
{% endif %}
}
